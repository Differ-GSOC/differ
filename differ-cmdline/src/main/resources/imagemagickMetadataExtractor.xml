<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:util="http://www.springframework.org/schema/util"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xsi:schemaLocation="
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
    http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd">

    <aop:config>
      <aop:aspect id="imagemagickMetadataTransformAspect" ref="imagemagickResultFinishingTransformer">
    	<aop:pointcut id="imagemagickTransformPointcut"
    		      expression="execution(* cz.nkp.differ.compare.metadata.external.ImagemagickTransformer.transform(..))"
    		      />
    	<aop:after-returning pointcut-ref="imagemagickTransformPointcut"
    			     returning="metadataList"
    			     method="transform"/>
      </aop:aspect>
    </aop:config>
    
    <bean id="imagemagickResultFinishingTransformer" class="cz.nkp.differ.compare.metadata.external.ResultFinishingTransformer">
      <property name="mapOfEntryNames">
	<map>
    	  <entry key="Image/Channel statistics/Image statistics/Artifacts/filename" value="File path"/>
    	  <entry key="Image" value="File name"/>
    	  <entry key="Image/Colorspace" value="Color space"/>
    	  <entry key="Image/Format" value="Type of format"/>
    	  <entry key="Image/Depth" value="Color depth"/>
    	  <entry key="Image/Channel statistics/Image statistics/Properties/date/create" value="File created"/>
    	  <entry key="Image/Channel statistics/Image statistics/Properties/date/modify" value="File last modified"/>
    	  <entry key="Image/Channel statistics/Image statistics/Properties/signature" value="Universal unique identifier (UUID)"/>
    	  <entry key="Image/Channel statistics/Image statistics/Compression" value="Compression"/>
    	  <entry key="Image/Channel statistics/Image statistics/Filesize" value="File size"/>
    	  <entry key="Image/Channel statistics/Image statistics/Quality" value="Compression quality"/>

	  <entry key="Image/Channel statistics/Green/kurtosis" value="Color/G/kurtosis"/>
	  <entry key="Image/Channel statistics/Green/max" value="Color/G/max"/>
	  <entry key="Image/Channel statistics/Green/min" value="Color/G/min"/>
	  <entry key="Image/Channel statistics/Green/mean" value="Color/G/mean"/>
	  <entry key="Image/Channel statistics/Green/skewness" value="Color/G/skewness"/>
	  <entry key="Image/Channel statistics/Green/standard deviation" value="Color/G/standard deviation"/>

	  <entry key="Image/Channel statistics/Red/kurtosis" value="Color/R/kurtosis"/>
	  <entry key="Image/Channel statistics/Red/max" value="Color/R/max"/>
	  <entry key="Image/Channel statistics/Red/min" value="Color/R/min"/>
	  <entry key="Image/Channel statistics/Red/mean" value="Color/R/mean"/>
	  <entry key="Image/Channel statistics/Red/skewness" value="Color/R/skewness"/>
	  <entry key="Image/Channel statistics/Red/standard deviation" value="Color/R/standard deviation"/>

	  <entry key="Image/Channel statistics/Blue/kurtosis" value="Color/B/kurtosis"/>
	  <entry key="Image/Channel statistics/Blue/max" value="Color/B/max"/>
	  <entry key="Image/Channel statistics/Blue/min" value="Color/B/min"/>
	  <entry key="Image/Channel statistics/Blue/mean" value="Color/B/mean"/>
	  <entry key="Image/Channel statistics/Blue/skewness" value="Color/B/skewness"/>
	  <entry key="Image/Channel statistics/Blue/standard deviation" value="Color/B/standard deviation"/>
	  <entry key="Image/Channel statistics/Image statistics/Properties/dc/format" value="MIME type"/>
	</map>
      </property>

      <property name="entryTransformers">
	<map>
	  <entry key="Type of format" value-ref="typeOfFormatNormalizer"/>
	  <entry key="Color depth" value-ref="justNumbersNormalizer"/>
	</map>
      </property>

      <property name="entryReplacers">
	<map>
	  <entry key="Image/Resolution" value-ref="resolutionReplacer"/>
	  <entry key="Image/Geometry" value-ref="geometryReplacer"/>
	</map>
      </property>
    </bean>

    
    <bean id="imagemagickMetadataTransformer" class="cz.nkp.differ.compare.metadata.external.ImagemagickTransformer"/>
    
    <bean id="imagemagickMetadataExtractor" class="cz.nkp.differ.compare.metadata.external.ExternalMetadataExtractor">
      <property name="source" value="imagemagick"/>
      <property name="transformer" ref="imagemagickMetadataTransformer"/>
      <property name="programArguments">
    	<list>
    	  <value>${imagemagick.binary}</value>
	  <value>-verbose</value>
    	  <value>{file}</value>
    	</list>
      </property>
      <property name="units" ref="units"/>
    </bean>
    
</beans>
